<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AbsenteismoController - GrupoBiomed</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%231a237e'/><text x='50' y='70' font-size='60' text-anchor='middle' fill='white'>A</text></svg>">
    
    <!-- Styles -->
    <link rel="stylesheet" href="/static/css/main.css">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <!-- Sistema de Cores por Cliente -->
    <script src="/static/js/cores-cliente.js"></script>
</head>
<body>
    <div class="container">
        <!-- Overlay para mobile -->
        <div class="sidebar-overlay" onclick="closeSidebar()"></div>
        
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <i class="fas fa-chart-line"></i> AbsenteismoController
                </div>
                <div class="sidebar-subtitle">GrupoBiomed</div>
            </div>
            
            <nav class="sidebar-nav">
                <a href="/dashboard" class="nav-item" id="navDashboard">
                    <i class="fas fa-chart-line"></i>
                    <span>Dashboard</span>
                </a>
                <a href="/clientes" class="nav-item">
                    <i class="fas fa-building"></i>
                    <span>üè¢ Clientes</span>
                </a>
                <a href="/apresentacao" class="nav-item">
                    <i class="fas fa-tv"></i>
                    <span>üìä Apresenta√ß√£o</span>
                </a>
                <a href="/upload" class="nav-item">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <span>üì§ Upload Planilha</span>
                </a>
                <a href="/dados_powerbi" class="nav-item">
                    <i class="fas fa-table"></i>
                    <span>üìã Meus Dados</span>
                </a>
                <a href="/funcionarios" class="nav-item">
                    <i class="fas fa-users"></i>
                    <span>üë• Funcion√°rios</span>
                </a>
                <a href="/comparativos" class="nav-item">
                    <i class="fas fa-balance-scale"></i>
                    <span>‚öñÔ∏è Comparativos</span>
                </a>
                <a href="/configuracoes" class="nav-item">
                    <i class="fas fa-cog"></i>
                    <span>‚öôÔ∏è Configura√ß√µes</span>
                </a>
            </nav>
            
            <div style="padding: 20px; margin-top: auto; border-top: 1px solid #e0e0e0;">
                <div id="userInfo" style="background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 12px; color: #666; margin-bottom: 10px;">
                        <i class="fas fa-user"></i> <span id="userName">Usu√°rio</span>
                    </div>
                    <button onclick="logout()" class="btn btn-secondary" style="width: 100%; padding: 8px; font-size: 12px;">
                        <i class="fas fa-sign-out-alt"></i> Sair
                    </button>
                </div>
            </div>
        </aside>
        
        <!-- Main Content -->
        <main class="main-content" style="display: flex; flex-direction: column; min-height: 100vh;">
            <header class="header">
                <button class="mobile-menu-toggle" onclick="toggleSidebar()" aria-label="Menu">
                    <i class="fas fa-bars"></i>
                </button>
                <h1 class="header-title">Dashboard</h1>
                <div class="header-actions" style="display: flex; align-items: center; gap: 16px; position: relative;">
                    <button onclick="window.print()" class="btn-print-header" title="Imprimir / Salvar como PDF" style="padding: 8px 16px; background: var(--primary); color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; display: flex; align-items: center; gap: 6px; white-space: nowrap;">
                        <i class="fas fa-print"></i>
                        <span>Imprimir</span>
                    </button>
                    <div style="position: relative; cursor: pointer;" onclick="toggleAlertasDropdown(event)">
                        <i class="fas fa-bell" style="color: #666; font-size: 20px;"></i>
                        <span id="alertasBadge" class="alertas-badge" style="display: none; position: absolute; top: -8px; right: -8px; background: #f44336; color: white; border-radius: 50%; width: 20px; height: 20px; font-size: 11px; display: flex; align-items: center; justify-content: center; font-weight: bold; border: 2px solid white;">0</span>
                    </div>
                    <div id="alertasDropdown" class="alertas-dropdown" style="display: none; position: absolute; top: calc(100% + 8px); right: 0; width: 400px; max-width: 90vw; background: white; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 1000; max-height: 500px; overflow-y: auto;">
                        <div style="padding: 12px; border-bottom: 1px solid #eee; font-weight: 600; font-size: 14px; background: #f8f9fa;">
                            <i class="fas fa-bell"></i> Alertas (<span id="alertasCount">0</span>)
                        </div>
                        <div id="alertasList" style="padding: 8px;">
                            <div style="text-align: center; padding: 20px; color: #999;">
                                <i class="fas fa-spinner fa-spin"></i> Carregando...
                            </div>
                        </div>
                    </div>
                </div>
            </header>
            
            <div class="content">
                 <!-- Insights Autom√°ticos -->
                <div id="insightsSection" class="insights-section" style="display: none;">
                    <h2 class="insights-title">
                        <i class="fas fa-lightbulb"></i>
                        An√°lises e Insights
                    </h2>
                    <div id="insightsContainer" class="insights-container"></div>
                </div>
                
                <!-- Filters -->
                <div class="filters">
                    <div class="filters-header" style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; padding-bottom: 16px; border-bottom: 2px solid var(--border);">
                        <h3 style="margin: 0; font-size: 18px; font-weight: 600; color: var(--text-primary); display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-filter" style="color: var(--primary);"></i>
                            Filtros de An√°lise
                        </h3>
                        <div class="filter-actions" style="display: flex; gap: 10px; align-items: center;">
                            <button class="btn btn-primary" onclick="aplicarFiltros()" style="padding: 10px 20px; font-size: 14px; font-weight: 500; border-radius: 8px; display: flex; align-items: center; gap: 8px; box-shadow: 0 2px 4px rgba(26, 35, 126, 0.2); transition: all 0.3s;">
                                <i class="fas fa-check"></i>
                                Aplicar Filtros
                            </button>
                            <button class="btn btn-secondary" onclick="salvarFiltroAtual()" style="padding: 10px 14px; font-size: 14px; border-radius: 8px; display: flex; align-items: center; gap: 6px; transition: all 0.3s;" title="Salvar Filtro">
                                <i class="fas fa-bookmark"></i>
                                <span style="display: none; margin-left: 4px;">Salvar</span>
                            </button>
                            <div class="dropdown" style="position: relative;">
                                <button class="btn btn-info" onclick="toggleFiltrosSalvos()" style="padding: 10px 14px; font-size: 14px; border-radius: 8px; display: flex; align-items: center; gap: 6px; transition: all 0.3s;" title="Filtros Salvos">
                                    <i class="fas fa-list"></i>
                                    <span style="display: none; margin-left: 4px;">Salvos</span>
                                </button>
                                <div id="dropdownFiltrosSalvos" class="dropdown-content" style="display: none; position: absolute; top: 100%; right: 0; margin-top: 8px; background: white; border: 1px solid #dee2e6; border-radius: 8px; min-width: 280px; max-height: 400px; overflow-y: auto; z-index: 1000; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
                                    <div style="padding: 14px 16px; border-bottom: 1px solid #dee2e6; font-weight: 600; font-size: 14px; color: #495057; background: #f8f9fa;">
                                        <i class="fas fa-bookmark" style="margin-right: 8px; color: var(--primary);"></i> Filtros Salvos
                                    </div>
                                    <div id="listaFiltrosSalvos" style="padding: 8px;">
                                        <div style="text-align: center; padding: 20px; color: #6c757d;">
                                            <i class="fas fa-spinner fa-spin"></i> Carregando...
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="filters-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; align-items: end;">
                        <div class="filter-group" style="margin: 0;">
                            <label class="filter-label" style="font-size: 13px; margin-bottom: 8px; font-weight: 500; color: var(--text-secondary); display: flex; align-items: center; gap: 6px;">
                                <i class="fas fa-calendar-alt" style="font-size: 12px; color: var(--primary);"></i>
                                M√™s In√≠cio
                            </label>
                            <input type="month" id="mesInicio" class="filter-input" style="padding: 10px 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 14px; transition: all 0.3s; width: 100%;">
                        </div>
                        <div class="filter-group" style="margin: 0;">
                            <label class="filter-label" style="font-size: 13px; margin-bottom: 8px; font-weight: 500; color: var(--text-secondary); display: flex; align-items: center; gap: 6px;">
                                <i class="fas fa-calendar-check" style="font-size: 12px; color: var(--primary);"></i>
                                M√™s Fim
                            </label>
                            <input type="month" id="mesFim" class="filter-input" style="padding: 10px 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 14px; transition: all 0.3s; width: 100%;">
                        </div>
                        <!-- Funcion√°rios -->
                        <div class="filter-group" style="margin: 0;">
                            <label class="filter-label" style="font-size: 13px; margin-bottom: 8px; font-weight: 500; color: var(--text-secondary); display: flex; align-items: center; gap: 6px;">
                                <i class="fas fa-users" style="font-size: 12px; color: var(--primary);"></i>
                                Funcion√°rios
                            </label>
                            <div class="multiselect-dropdown" style="position: relative;">
                                <div class="multiselect-trigger" onclick="toggleDropdown('funcionarios')" style="padding: 10px 12px; border: 1px solid var(--border); border-radius: 8px; background: white; cursor: pointer; display: flex; justify-content: space-between; align-items: center; min-height: 42px; transition: all 0.3s;">
                                    <span id="funcionariosText" style="color: #6c757d; font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; flex: 1;">Selecione...</span>
                                    <i class="fas fa-chevron-down" style="color: #6c757d; transition: transform 0.3s; margin-left: 8px; flex-shrink: 0;" id="funcionariosIcon"></i>
                                </div>
                                <div id="dropdownFuncionarios" class="multiselect-dropdown-content" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid #dee2e6; border-radius: 8px; max-height: 300px; overflow-y: auto; z-index: 1000; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
                                    <div style="padding: 10px; border-bottom: 1px solid #dee2e6; display: flex; gap: 8px; background: #f8f9fa;">
                                        <button type="button" onclick="selecionarTodos('funcionarios')" style="flex: 1; padding: 8px; border: 1px solid #1a237e; color: #1a237e; background: white; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 500; transition: all 0.3s;">
                                            Todos
                                        </button>
                                        <button type="button" onclick="desselecionarTodos('funcionarios')" style="flex: 1; padding: 8px; border: 1px solid #6c757d; color: #6c757d; background: white; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 500; transition: all 0.3s;">
                                            Nenhum
                                        </button>
                                    </div>
                                    <div id="checkboxesFuncionarios" style="padding: 8px;">
                                        <div style="text-align: center; padding: 20px; color: #6c757d;">
                                            <i class="fas fa-spinner fa-spin"></i> Carregando...
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Setores -->
                        <div class="filter-group" style="margin: 0;">
                            <label class="filter-label" style="font-size: 13px; margin-bottom: 8px; font-weight: 500; color: var(--text-secondary); display: flex; align-items: center; gap: 6px;">
                                <i class="fas fa-building" style="font-size: 12px; color: var(--primary);"></i>
                                Setores
                            </label>
                            <div class="multiselect-dropdown" style="position: relative;">
                                <div class="multiselect-trigger" onclick="toggleDropdown('setores')" style="padding: 10px 12px; border: 1px solid var(--border); border-radius: 8px; background: white; cursor: pointer; display: flex; justify-content: space-between; align-items: center; min-height: 42px; transition: all 0.3s;">
                                    <span id="setoresText" style="color: #6c757d; font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; flex: 1;">Selecione...</span>
                                    <i class="fas fa-chevron-down" style="color: #6c757d; transition: transform 0.3s; margin-left: 8px; flex-shrink: 0;" id="setoresIcon"></i>
                                </div>
                                <div id="dropdownSetores" class="multiselect-dropdown-content" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid #dee2e6; border-radius: 8px; max-height: 300px; overflow-y: auto; z-index: 1000; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
                                    <div style="padding: 10px; border-bottom: 1px solid #dee2e6; display: flex; gap: 8px; background: #f8f9fa;">
                                        <button type="button" onclick="selecionarTodos('setores')" style="flex: 1; padding: 8px; border: 1px solid #1a237e; color: #1a237e; background: white; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 500; transition: all 0.3s;">
                                            Todos
                                        </button>
                                        <button type="button" onclick="desselecionarTodos('setores')" style="flex: 1; padding: 8px; border: 1px solid #6c757d; color: #6c757d; background: white; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 500; transition: all 0.3s;">
                                            Nenhum
                                        </button>
                                    </div>
                                    <div id="checkboxesSetores" style="padding: 8px;">
                                        <div style="text-align: center; padding: 20px; color: #6c757d;">
                                            <i class="fas fa-spinner fa-spin"></i> Carregando...
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- KPI Cards (s√≥ aparecem se houver dados) -->
                <div class="cards-grid" id="cardsGridContainer" style="display: none; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 24px;">
                    <div class="card">
                        <div class="card-header">
                            <div>
                                <div class="card-title">Dias Perdidos</div>
                                <div class="card-value" id="cardDiasPerdidos">-</div>
                            </div>
                            <div class="card-icon warning">
                                <i class="fas fa-calendar-times"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <div>
                                <div class="card-title">Horas Perdidas</div>
                                <div class="card-value" id="cardHorasPerdidas">-</div>
                            </div>
                            <div class="card-icon danger">
                                <i class="fas fa-hourglass-half"></i>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Charts Grid - Layout Otimizado (APENAS CONVERPLAST) -->
                <div id="graficosConverplast">
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 16px;">
                    <!-- TOP CIDs -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">TOP 10 Doen√ßas mais Frequentes</h3>
                            <p class="chart-subtitle">Principais causas de afastamento (exceto exames/doa√ß√µes)</p>
                        </div>
                        <div class="chart-wrapper" style="height: 350px;">
                            <canvas id="chartCids"></canvas>
                        </div>
                    </div>
                    
                    <!-- Evolu√ß√£o Mensal -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">Evolu√ß√£o Mensal - √öltimos 12 Meses</h3>
                            <p class="chart-subtitle">Tend√™ncia de atestados e dias perdidos</p>
                        </div>
                        <div class="chart-wrapper" style="height: 350px;">
                            <canvas id="chartEvolucao"></canvas>
                        </div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 16px;">
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">Quantidade de Atestados por M√™s</h3>
                            <p class="chart-subtitle">Total de atestados registrados mensalmente</p>
                        </div>
                        <div class="chart-wrapper" style="height: 300px;">
                            <canvas id="chartQuantidadeAtestados"></canvas>
                        </div>
                    </div>
                    
                    <!-- Gr√°fico Combinado: Atestados vs Taxa de Absente√≠smo -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">Atestados vs Taxa de Absente√≠smo</h3>
                            <p class="chart-subtitle">Quantidade (barras) e Taxa % (linha)</p>
                        </div>
                        <div class="chart-wrapper" style="height: 300px;">
                            <canvas id="chartAtestadosVsTaxa"></canvas>
                        </div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 16px;">
                    <!-- Comparativo Ano Anterior -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">Comparativo Ano Anterior</h3>
                            <p class="chart-subtitle">Atual vs Mesmo Per√≠odo Ano Passado</p>
                        </div>
                        <div class="chart-wrapper" style="height: 300px;">
                            <canvas id="chartComparativoAnoAnterior"></canvas>
                        </div>
                    </div>
                    
                    <!-- An√°lise de Sazonalidade -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">Sazonalidade - M√©dia Hist√≥rica</h3>
                            <p class="chart-subtitle">M√©dia de cada m√™s ao longo dos anos</p>
                        </div>
                        <div class="chart-wrapper" style="height: 300px;">
                            <canvas id="chartSazonalidade"></canvas>
                        </div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 16px;">
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">Varia√ß√£o Mensal</h3>
                            <p class="chart-subtitle">Diferen√ßa m√™s a m√™s (dias x horas)</p>
                        </div>
                        <div class="chart-wrapper" style="height: 300px;">
                            <canvas id="chartVariacaoMensal"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">Distribui√ß√£o Mensal por G√™nero</h3>
                            <p class="chart-subtitle">Participa√ß√£o mensal de Masculino x Feminino</p>
                        </div>
                        <div class="chart-wrapper" style="height: 300px;">
                            <canvas id="chartGeneroMensal"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- Heatmap Setores x Meses -->
                <div class="chart-container" style="margin-bottom: 16px;">
                    <div class="chart-header">
                        <h3 class="chart-title">Mapa de Calor: Setores x Meses</h3>
                        <p class="chart-subtitle">Dias perdidos por setor em cada m√™s (cores mais fortes = mais cr√≠ticos)</p>
                    </div>
                    <div id="heatmapContainer" style="padding: 20px; max-height: 600px; overflow: auto;">
                        <!-- Heatmap ser√° renderizado aqui via JavaScript -->
                    </div>
                </div>
                
                <!-- Top CIDs por Setor -->
                <div class="chart-container" style="margin-bottom: 16px;">
                    <div class="chart-header">
                        <h3 class="chart-title">Top CIDs por Setor</h3>
                        <p class="chart-subtitle">Principais causas de afastamento em cada setor</p>
                    </div>
                    <div class="chart-wrapper" style="height: 400px;">
                        <canvas id="chartTopCidsSetor"></canvas>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-bottom: 16px;">
                    <!-- TOP Setores -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">TOP 5 Setores</h3>
                            <p class="chart-subtitle">Setores com mais atestados</p>
                        </div>
                        <div class="chart-wrapper" style="height: 280px;">
                            <canvas id="chartSetores"></canvas>
                        </div>
                    </div>
                    
                    <!-- Distribui√ß√£o por G√™nero -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">Funcion√°rios por G√™nero</h3>
                            <p class="chart-subtitle">Masculino vs Feminino</p>
                        </div>
                        <div class="chart-wrapper" style="height: 280px;">
                            <canvas id="chartGenero"></canvas>
                        </div>
                    </div>
                    
                    <!-- Dias por Doen√ßa -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">Dias por Doen√ßa</h3>
                            <p class="chart-subtitle">Total de dias perdidos</p>
                        </div>
                        <div class="chart-wrapper" style="height: 280px;">
                            <canvas id="chartMediaCid"></canvas>
                        </div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 16px;">
                    <!-- Dias Perdidos por Funcion√°rios -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">Dias Perdidos por Funcion√°rios</h3>
                            <p class="chart-subtitle">TOP 10 funcion√°rios com mais dias perdidos</p>
                        </div>
                        <div class="chart-wrapper" style="height: 350px;">
                            <canvas id="chartFuncionariosDias"></canvas>
                        </div>
                    </div>
                    
                    <!-- Evolu√ß√£o por Setor -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">Evolu√ß√£o de Dias Perdidos por Setor</h3>
                            <p class="chart-subtitle">Tend√™ncia dos principais setores</p>
                        </div>
                        <div class="chart-wrapper" style="height: 350px;">
                            <canvas id="chartEvolucaoSetor"></canvas>
                        </div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 16px;">
                    <!-- Escalas com mais Atestados -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">Escalas (Hor√°rios) com mais Atestados</h3>
                            <p class="chart-subtitle">TOP 10 escalas com maior incid√™ncia</p>
                        </div>
                        <div class="chart-wrapper" style="height: 350px;">
                            <canvas id="chartEscalas"></canvas>
                        </div>
                    </div>
                    
                    <!-- Motivos de Incid√™ncia -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">Motivos de Incid√™ncia com mais Atestados</h3>
                            <p class="chart-subtitle">Distribui√ß√£o percentual dos motivos</p>
                        </div>
                        <div class="chart-wrapper" style="height: 350px;">
                            <canvas id="chartMotivos"></canvas>
                        </div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 16px;">
                    <!-- Comparativo entre Per√≠odos -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">Comparativo Mensal</h3>
                            <p class="chart-subtitle">M√™s atual vs m√™s anterior</p>
                        </div>
                        <div class="chart-wrapper" style="height: 350px;">
                            <canvas id="chartComparativoMensal"></canvas>
                        </div>
                    </div>
                    
                    <!-- Comparativo Trimestral -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">Comparativo Trimestral</h3>
                            <p class="chart-subtitle">Trimestre atual vs anterior</p>
                        </div>
                        <div class="chart-wrapper" style="height: 350px;">
                            <canvas id="chartComparativoTrimestral"></canvas>
                        </div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 16px;">
                    <!-- Dias Perdidos por Centro de Custo (Setor) -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">Dias Perdidos por Centro de Custo</h3>
                            <p class="chart-subtitle">TOP 10 setores</p>
                        </div>
                        <div class="chart-wrapper" style="height: 350px;">
                            <canvas id="chartCentroCusto"></canvas>
                        </div>
                    </div>
                    
                    <!-- Distribui√ß√£o de Dias por Atestado -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">Distribui√ß√£o de Dias por Atestado</h3>
                            <p class="chart-subtitle">Histograma de frequ√™ncia</p>
                        </div>
                        <div class="chart-wrapper" style="height: 350px;">
                            <canvas id="chartDistribuicaoDias"></canvas>
                        </div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 16px;">
                    <!-- M√©dia de Dias por CID -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">M√©dia de Dias por CID</h3>
                            <p class="chart-subtitle">Doen√ßas com maior m√©dia de dias</p>
                        </div>
                        <div class="chart-wrapper" style="height: 350px;">
                            <canvas id="chartMediaCidDias"></canvas>
                        </div>
                    </div>
                    
                    <!-- Dias Perdidos por Setor e G√™nero -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">Dias Perdidos por Setor e G√™nero</h3>
                            <p class="chart-subtitle">Comparativo entre g√™neros por setor</p>
                        </div>
                        <div class="chart-wrapper" style="height: 350px;">
                            <canvas id="chartSetorGenero"></canvas>
                        </div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 16px;">
                    <!-- Comparativo Dias vs Horas -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">Comparativo: Dias vs Horas Perdidas</h3>
                            <p class="chart-subtitle">Por setor</p>
                        </div>
                        <div class="chart-wrapper" style="height: 350px;">
                            <canvas id="chartComparativoDiasHoras"></canvas>
                        </div>
                    </div>
                    
                    <!-- Frequ√™ncia de Atestados por Funcion√°rio -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">Frequ√™ncia de Atestados por Funcion√°rio</h3>
                            <p class="chart-subtitle">Distribui√ß√£o de funcion√°rios por n√∫mero de atestados</p>
                        </div>
                        <div class="chart-wrapper" style="height: 350px;">
                            <canvas id="chartFrequenciaAtestados"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- Produtividade -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">Produtividade - Consultas por Categoria</h3>
                            <p class="chart-subtitle">Distribui√ß√£o de consultas por tipo (√∫ltimo m√™s cadastrado)</p>
                        </div>
                        <div class="chart-wrapper" style="height: 350px;">
                            <canvas id="chartProdutividade"></canvas>
                        </div>
                    </div>
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">Produtividade - Evolu√ß√£o Mensal</h3>
                            <p class="chart-subtitle">Evolu√ß√£o do total de consultas m√™s a m√™s</p>
                        </div>
                        <div class="chart-wrapper" style="height: 350px;">
                            <canvas id="chartProdutividadeEvolucao"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- Produtividade por M√™s e Categoria -->
                <div class="chart-container" style="margin-bottom: 16px;">
                    <div class="chart-header">
                        <h3 class="chart-title">Produtividade - Distribui√ß√£o Anual (M√™s a M√™s) por Categoria</h3>
                        <p class="chart-subtitle">Barras empilhadas mostrando a distribui√ß√£o percentual m√™s a m√™s</p>
                    </div>
                    <div class="chart-wrapper" style="height: 400px;">
                        <canvas id="chartProdutividadeMensalCategoria"></canvas>
                    </div>
                </div>
                </div>
                <!-- FIM GR√ÅFICOS CONVERPLAST -->
                
                <!-- GR√ÅFICOS ESPEC√çFICOS RODA DE OURO -->
                <div id="graficosRodaOuro" style="display: none; margin-top: 32px; padding-top: 32px; border-top: 2px solid #e0e0e0;">
                    <h2 style="font-size: 24px; font-weight: 600; color: #333; margin-bottom: 24px; text-align: center;">
                        <i class="fas fa-chart-bar" style="margin-right: 8px; color: #1a237e;"></i>
                        An√°lises Espec√≠ficas - Roda de Ouro
                    </h2>
                    
                    <!-- Grid 2x3 para os 6 gr√°ficos -->
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 20px;">
                        <!-- 1. Classifica√ß√£o por Funcion√°rio -->
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">Classifica√ß√£o por Funcion√°rio</h3>
                                <p class="chart-subtitle">Funcion√°rios com mais atestados</p>
                            </div>
                            <div class="chart-wrapper" style="height: 400px;">
                                <canvas id="chartClassificacaoFuncionariosRO"></canvas>
                            </div>
                        </div>
                        
                        <!-- 2. Classifica√ß√£o Por Setor -->
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">Classifica√ß√£o Por Setor</h3>
                                <p class="chart-subtitle">Setores com mais dias de afastamento</p>
                            </div>
                            <div class="chart-wrapper" style="height: 400px;">
                                <canvas id="chartClassificacaoSetoresRO"></canvas>
                            </div>
                        </div>
                        
                        <!-- 3. Dias atestados por Ano -->
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">Dias atestados por Ano</h3>
                                <p class="chart-subtitle">Coerente vs Sem Coer√™ncia</p>
                            </div>
                            <div class="chart-wrapper" style="height: 400px;">
                                <canvas id="chartDiasAnoCoerencia"></canvas>
                            </div>
                        </div>
                        
                        <!-- 4. Classifica√ß√£o por Doen√ßa -->
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">Classifica√ß√£o por Doen√ßa</h3>
                                <p class="chart-subtitle">Doen√ßas x Dias de Afastamento</p>
                            </div>
                            <div class="chart-wrapper" style="height: 400px;">
                                <canvas id="chartClassificacaoDoencasRO"></canvas>
                            </div>
                        </div>
                        
                        <!-- 5. An√°lise Atestados -->
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">An√°lise Atestados</h3>
                                <p class="chart-subtitle">Percentual de coer√™ncia</p>
                            </div>
                            <div class="chart-wrapper" style="height: 400px;">
                                <canvas id="chartAnaliseCoerencia"></canvas>
                            </div>
                        </div>
                        
                        <!-- 6. Tempo Servi√ßo x Atestados -->
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">Tempo Servi√ßo x Atestados</h3>
                                <p class="chart-subtitle">Atestados por ano</p>
                            </div>
                            <div class="chart-wrapper" style="height: 400px;">
                                <canvas id="chartTempoServicoAtestados"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- NOVOS GR√ÅFICOS DE HORAS PERDIDAS -->
                    <h3 style="font-size: 20px; font-weight: 600; color: #333; margin-top: 40px; margin-bottom: 24px; text-align: center; padding-top: 24px; border-top: 2px solid #e0e0e0;">
                        <i class="fas fa-clock" style="margin-right: 8px; color: #1a237e;"></i>
                        An√°lises de Horas Perdidas
                    </h3>
                    
                    <!-- Grid 2x3 para os novos gr√°ficos de horas -->
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 20px;">
                        <!-- 1. Horas Perdidas por G√™nero -->
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">Horas Perdidas por G√™nero</h3>
                                <p class="chart-subtitle">Distribui√ß√£o de horas perdidas (44h = 1 semana)</p>
                            </div>
                            <div class="chart-wrapper" style="height: 400px;">
                                <canvas id="chartHorasPerdidasGenero"></canvas>
                            </div>
                        </div>
                        
                        <!-- 2. Horas Perdidas por Setor -->
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">TOP 10 Setores - Horas Perdidas</h3>
                                <p class="chart-subtitle">Setores com mais horas perdidas</p>
                            </div>
                            <div class="chart-wrapper" style="height: 400px;">
                                <canvas id="chartHorasPerdidasSetor"></canvas>
                            </div>
                        </div>
                        
                        <!-- 3. Evolu√ß√£o Mensal de Horas -->
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">Evolu√ß√£o Mensal de Horas Perdidas</h3>
                                <p class="chart-subtitle">Tend√™ncia de horas perdidas ao longo do tempo</p>
                            </div>
                            <div class="chart-wrapper" style="height: 400px;">
                                <canvas id="chartEvolucaoMensalHoras"></canvas>
                            </div>
                        </div>
                        
                        <!-- 4. Comparativo Dias vs Horas por G√™nero -->
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">Comparativo: Dias vs Horas vs Semanas</h3>
                                <p class="chart-subtitle">Compara√ß√£o por g√™nero</p>
                            </div>
                            <div class="chart-wrapper" style="height: 400px;">
                                <canvas id="chartComparativoDiasHorasGenero"></canvas>
                            </div>
                        </div>
                        
                        <!-- 5. Horas Perdidas por Setor e G√™nero -->
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">Horas Perdidas por Setor e G√™nero</h3>
                                <p class="chart-subtitle">Cruzamento Setor √ó G√™nero</p>
                            </div>
                            <div class="chart-wrapper" style="height: 400px;">
                                <canvas id="chartHorasPerdidasSetorGenero"></canvas>
                            </div>
                        </div>
                        
                        <!-- 6. An√°lise Detalhada por G√™nero -->
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">An√°lise Detalhada por G√™nero</h3>
                                <p class="chart-subtitle">Percentuais de dias, horas e registros</p>
                            </div>
                            <div class="chart-wrapper" style="height: 400px;">
                                <canvas id="chartAnaliseDetalhadaGenero"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Footer -->
            <footer style="background: var(--surface); border-top: 1px solid var(--border); padding: 20px; text-align: center; color: var(--text-secondary); font-size: 13px; margin-top: auto;">
                <p style="margin: 0;">
                    &copy; 2025 GrupoBiomed - Criado por √âde Carlos Viana Machado
                </p>
            </footer>
        </main>
    </div>
    
    <script src="/static/js/menu.js"></script>
    <script src="/static/js/dashboard.js"></script>
    <script>
        // Aguarda cores do cliente carregarem antes de inicializar dashboard
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                // Verifica se h√° cliente selecionado
                const clientId = typeof window.getCurrentClientId === 'function' ? window.getCurrentClientId(null) : null;
                
                // Se n√£o h√° cliente selecionado, redireciona para p√°gina de clientes
                if (!clientId || clientId <= 0) {
                    console.log('[DASHBOARD] Nenhum cliente selecionado. Redirecionando para /clientes...');
                    window.location.href = '/clientes';
                    return;
                }
                
                // Se h√° cliente, carrega cores e dashboard
                if (typeof carregarCoresCliente === 'function') {
                    carregarCoresCliente(clientId).then(() => {
                        if (typeof carregarDashboard === 'function') {
                            carregarDashboard();
                        }
                    });
                } else {
                    if (typeof carregarDashboard === 'function') {
                        carregarDashboard();
                    }
                }
            }, 800);
        });
    </script>
    <script>
        // Fecha dropdowns ao clicar fora
        document.addEventListener('click', function(event) {
            if (!event.target.closest('.multiselect-dropdown')) {
                document.querySelectorAll('.multiselect-dropdown-content').forEach(dd => {
                    dd.style.display = 'none';
                });
                document.querySelectorAll('.multiselect-dropdown i').forEach(icon => {
                    icon.style.transform = 'rotate(0deg)';
                });
            }
        });
        
        // Carrega alertas do menu
        async function carregarAlertasMenu() {
            try {
                const clientId = typeof getCurrentClientId === 'function' ? getCurrentClientId() : 1;
                
                // Se n√£o tem cliente, n√£o carrega alertas
                if (!clientId || clientId <= 0) {
                    return;
                }
                
                const mesInicio = document.getElementById('mesInicio')?.value || '';
                const mesFim = document.getElementById('mesFim')?.value || '';
                
                let url = `/api/alertas?client_id=${clientId}`;
                if (mesInicio) url += `&mes_inicio=${encodeURIComponent(mesInicio)}`;
                if (mesFim) url += `&mes_fim=${encodeURIComponent(mesFim)}`;
                
                // Obt√©m token de autentica√ß√£o
                const token = typeof getAccessToken === 'function' ? getAccessToken() : localStorage.getItem('access_token');
                const headers = {};
                if (token) {
                    headers['Authorization'] = `Bearer ${token}`;
                }
                
                const response = await fetch(url, { headers });
                if (!response.ok) {
                    if (response.status === 401) {
                        console.warn('Token expirado ou inv√°lido para alertas - ignorando');
                        return;
                    }
                    return;
                }
                
                const data = await response.json();
                const total = data.total || 0;
                window.alertasData = data.alertas || [];
                
                const badge = document.getElementById('alertasBadge');
                if (badge) {
                    if (total > 0) {
                        badge.textContent = total;
                        badge.style.display = 'flex';
                    } else {
                        badge.style.display = 'none';
                    }
                }
            } catch (error) {
                console.error('Erro ao carregar alertas:', error);
            }
        }
        
        // Toggle dropdown de alertas
        function toggleAlertasDropdown(event) {
            event.stopPropagation();
            event.preventDefault();
            const dropdown = document.getElementById('alertasDropdown');
            if (!dropdown) return;
            
            // Fecha outros dropdowns
            document.querySelectorAll('.alertas-dropdown').forEach(dd => {
                if (dd !== dropdown) dd.style.display = 'none';
            });
            
            if (dropdown.style.display === 'none' || !dropdown.style.display) {
                dropdown.style.display = 'block';
                renderizarAlertasDropdown();
            } else {
                dropdown.style.display = 'none';
            }
        }
        
        // Renderiza alertas no dropdown
        function renderizarAlertasDropdown() {
            const container = document.getElementById('alertasList');
            const countEl = document.getElementById('alertasCount');
            const alertas = window.alertasData || [];
            
            if (countEl) countEl.textContent = alertas.length;
            
            if (!container) return;
            
            if (alertas.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 20px; color: #999;">Nenhum alerta</div>';
                return;
            }
            
            const severidades = {'alta': 3, 'media': 2, 'baixa': 1};
            const alertasOrdenados = [...alertas].sort((a, b) => 
                (severidades[b.severidade] || 0) - (severidades[a.severidade] || 0)
            );
            
            container.innerHTML = alertasOrdenados.map(alerta => {
                const icone = alerta.severidade === 'alta' ? 'fa-exclamation-circle' : 
                             alerta.severidade === 'media' ? 'fa-exclamation-triangle' : 'fa-info-circle';
                const cor = alerta.severidade === 'alta' ? '#f44336' : 
                           alerta.severidade === 'media' ? '#ff9800' : '#2196f3';
                
                let acaoBtn = '';
                if (alerta.tipo === 'funcionario_alto_absenteismo' || alerta.tipo === 'funcionario_frequente') {
                    acaoBtn = `<a href="/perfil_funcionario?nome=${encodeURIComponent(alerta.dados.nome)}" style="display: inline-block; margin-top: 8px; padding: 4px 12px; background: #1a237e; color: white; border-radius: 4px; text-decoration: none; font-size: 12px;">
                        <i class="fas fa-user-circle"></i> Ver Perfil
                    </a>`;
                }
                
                return `
                    <div style="padding: 12px; border-bottom: 1px solid #f0f0f0;">
                        <div style="display: flex; align-items: flex-start; gap: 8px;">
                            <i class="fas ${icone}" style="color: ${cor}; margin-top: 4px; font-size: 16px;"></i>
                            <div style="flex: 1;">
                                <div style="font-weight: 600; font-size: 13px; color: #333; margin-bottom: 4px;">${alerta.titulo}</div>
                                <div style="font-size: 12px; color: #666; line-height: 1.4;">${alerta.mensagem}</div>
                                ${acaoBtn}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Fecha dropdown ao clicar fora
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('alertasDropdown');
            const headerActions = document.querySelector('.header-actions');
            if (dropdown && headerActions && !headerActions.contains(event.target)) {
                dropdown.style.display = 'none';
            }
        });
        
        // ==================== MOBILE MENU ====================
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.querySelector('.sidebar-overlay');
            
            if (sidebar && overlay) {
                sidebar.classList.toggle('open');
                overlay.classList.toggle('active');
                
                // Previne scroll do body quando menu est√° aberto
                if (sidebar.classList.contains('open')) {
                    document.body.style.overflow = 'hidden';
                } else {
                    document.body.style.overflow = '';
                }
            }
        }
        
        function closeSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.querySelector('.sidebar-overlay');
            
            if (sidebar && overlay) {
                sidebar.classList.remove('open');
                overlay.classList.remove('active');
                document.body.style.overflow = '';
            }
        }
        
        // Fecha sidebar ao clicar em um link (mobile)
        document.addEventListener('DOMContentLoaded', function() {
            const navItems = document.querySelectorAll('.sidebar-nav .nav-item');
            navItems.forEach(item => {
                item.addEventListener('click', function() {
                    // S√≥ fecha em mobile (largura < 1024px)
                    if (window.innerWidth < 1024) {
                        closeSidebar();
                    }
                });
            });
            
            // Fecha sidebar ao redimensionar para desktop
            let resizeTimer;
            window.addEventListener('resize', function() {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(function() {
                    if (window.innerWidth >= 1024) {
                        closeSidebar();
                    }
                }, 250);
            });
        });
        
        // Carrega alertas ap√≥s carregar dashboard
        setTimeout(carregarAlertasMenu, 2000);
        setInterval(carregarAlertasMenu, 5 * 60 * 1000);
    </script>
    <script src="/static/js/auth.js"></script>
</body>
</html>
