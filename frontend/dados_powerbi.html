<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>An√°lise de Dados - PowerBI Style</title>
    
    <link rel="stylesheet" href="/static/css/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script>
        // Verifica se XLSX foi carregado
        window.addEventListener('load', function() {
            if (typeof XLSX !== 'undefined' || typeof window.XLSX !== 'undefined') {
                console.log('‚úÖ Biblioteca XLSX carregada com sucesso');
            } else {
                console.error('‚ùå Biblioteca XLSX n√£o foi carregada');
            }
        });
    </script>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--background, #f8f9fa);
        }
        
        .powerbi-container {
            min-height: 100vh;
            padding: 24px 32px;
            background: var(--background, #f5f7fa);
        }
        
        [data-theme="dark"] body {
            background: var(--background) !important;
        }
        
        [data-theme="dark"] .powerbi-container {
            background: var(--background) !important;
        }
        
        .dados-content {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 24px;
        }
        
        .toolbar {
            background: var(--surface, white);
            padding: 16px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        [data-theme="dark"] .toolbar {
            background: var(--surface) !important;
            border-color: var(--border) !important;
        }
        
        .search-box {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 300px;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-left: 8px;
        }
        
        .btn-primary {
            background: #00bcf2;
            color: white;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .data-table {
            background: var(--surface, white);
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
         .table-header {
             background: var(--surface-hover, #f8f9fa);
             padding: 16px;
             border-bottom: 1px solid #dee2e6;
             font-weight: 600;
             color: #495057;
         }
         
         [data-theme="dark"] .table-header {
             background: var(--surface-hover) !important;
             color: var(--text-primary) !important;
             border-color: var(--border) !important;
         }
        
        .table-container {
            overflow-x: scroll;
            overflow-y: auto;
            max-height: 70vh;
            scrollbar-width: thick;
            scrollbar-color: #00bcf2 #f1f1f1;
            /* Garante que a barra horizontal sempre apare√ßa */
            width: 100%;
        }
        
        .table-container::-webkit-scrollbar {
            width: 16px;
            height: 16px;
        }
        
        .table-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 8px;
        }
        
        .table-container::-webkit-scrollbar-thumb {
            background: #00bcf2;
            border-radius: 8px;
            border: 2px solid #f1f1f1;
        }
        
        .table-container::-webkit-scrollbar-thumb:hover {
            background: #0099cc;
        }
        
        .table-container::-webkit-scrollbar-corner {
            background: #f1f1f1;
        }
        
        table {
            width: max-content;
            min-width: 100%;
            border-collapse: collapse;
            /* For√ßa a tabela a ter largura suficiente para scroll horizontal */
            white-space: nowrap;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
            white-space: nowrap;
            /* Garante que as c√©lulas n√£o quebrem */
            min-width: 100px;
        }
        
         th {
             background: var(--surface-hover, #f8f9fa);
             font-weight: 600;
             color: #495057;
             position: sticky;
             top: 0;
             z-index: 10;
         }
         
         [data-theme="dark"] th {
             background: var(--surface-hover) !important;
             color: var(--text-primary) !important;
             border-color: var(--border) !important;
         }
         
         tr:hover {
             background: var(--surface-hover, #f8f9fa);
         }
         
         [data-theme="dark"] tr:hover {
             background: var(--surface-hover) !important;
         }
        
        .editable {
            cursor: pointer;
            position: relative;
        }
        
        .editable:hover {
            background: #e3f2fd !important;
        }
        
        .editable input {
            width: 100%;
            border: 2px solid #00bcf2;
            padding: 4px;
            font-size: 14px;
            border-radius: 4px;
        }
        
        .cell-focused {
            background: #e3f2fd !important;
            border: 2px solid #00bcf2 !important;
        }
        
        .stats {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: var(--surface, white);
            padding: 16px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
            flex: 1;
        }
        
        [data-theme="dark"] .stat-card {
            background: var(--surface) !important;
            border-color: var(--border) !important;
        }
        
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #00bcf2;
        }
        
        .stat-label {
            font-size: 14px;
            color: #6c757d;
            margin-top: 4px;
        }
        
        .filter-dropdown {
            position: absolute;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            z-index: 1000;
            min-width: 200px;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }
        
        .filter-dropdown.show {
            display: block;
        }
        
        .filter-option {
            padding: 8px 12px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .filter-option:hover {
            background: #f8f9fa;
        }
        
        .filter-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            margin-left: 8px;
        }
        
        .filter-btn:hover {
            background: #e9ecef;
        }
        
        .filter-btn.active {
            background: #00bcf2;
            color: white;
        }
        
         /* Abas de Meses */
         .meses-tabs {
             background: var(--surface, white);
             border-radius: 8px;
             box-shadow: 0 2px 4px rgba(0,0,0,0.1);
             margin-bottom: 20px;
             padding: 16px;
             display: flex;
             flex-wrap: wrap;
             gap: 8px;
             align-items: center;
         }
         
         [data-theme="dark"] .meses-tabs {
             background: var(--surface) !important;
             border-color: var(--border) !important;
         }
        
        .meses-tabs-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-right: 16px;
            font-weight: 600;
            color: #495057;
        }
        
         .mes-tab {
             padding: 8px 16px;
             border: 2px solid #dee2e6;
             border-radius: 6px;
             background: var(--surface, white);
             cursor: pointer;
             font-size: 13px;
             font-weight: 600;
             color: #6c757d;
             transition: all 0.2s;
             min-width: 80px;
             text-align: center;
         }
         
         [data-theme="dark"] .mes-tab {
             background: var(--surface) !important;
             border-color: var(--border) !important;
             color: var(--text-secondary) !important;
         }
        
        .mes-tab:hover {
            border-color: #00bcf2;
            color: #00bcf2;
            background: rgba(0, 188, 242, 0.05);
        }
        
        .mes-tab.active {
            background: #00bcf2;
            color: white;
            border-color: #00bcf2;
        }
        
         /* Seletores de Per√≠odo */
         .periodo-selectors {
             background: var(--surface, white);
             border-radius: 8px;
             box-shadow: 0 2px 4px rgba(0,0,0,0.1);
             margin-bottom: 20px;
             padding: 16px;
             display: flex;
             gap: 16px;
             align-items: center;
             flex-wrap: wrap;
         }
         
         [data-theme="dark"] .periodo-selectors {
             background: var(--surface) !important;
             border-color: var(--border) !important;
         }
        
        .periodo-selector {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .periodo-selector label {
            font-size: 12px;
            font-weight: 600;
            color: #495057;
        }
        
        .periodo-selector select {
            padding: 8px 12px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            font-size: 14px;
            min-width: 150px;
            cursor: pointer;
        }
        
        .periodo-selector select:focus {
            outline: none;
            border-color: #00bcf2;
            box-shadow: 0 0 0 3px rgba(0, 188, 242, 0.1);
        }
        
         /* Visualiza√ß√£o de Tend√™ncia Anual */
         .tendencia-anual {
             background: var(--surface, white);
             border-radius: 8px;
             box-shadow: 0 2px 4px rgba(0,0,0,0.1);
             padding: 24px;
             margin-bottom: 20px;
             display: none;
         }
         
         [data-theme="dark"] .tendencia-anual {
             background: var(--surface) !important;
             border-color: var(--border) !important;
         }
        
        .tendencia-anual.show {
            display: block;
        }
        
        .tendencia-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .tendencia-header h3 {
            margin: 0;
            color: #495057;
            font-size: 20px;
        }
        
        .tendencia-charts {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
         .tendencia-chart {
             background: var(--surface-hover, #f8f9fa);
             border-radius: 8px;
             padding: 16px;
             min-height: 300px;
         }
         
         [data-theme="dark"] .tendencia-chart {
             background: var(--surface-hover) !important;
         }
         
         .analise-macro {
             background: var(--surface-hover, #f8f9fa);
             border-radius: 8px;
             padding: 20px;
             margin-top: 20px;
         }
         
         [data-theme="dark"] .analise-macro {
             background: var(--surface-hover) !important;
         }
        
        .analise-macro h4 {
            margin: 0 0 16px 0;
            color: #495057;
            font-size: 18px;
        }
        
        .analise-macro-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
        }
        
         .analise-item {
             background: var(--surface, white);
             padding: 16px;
             border-radius: 6px;
             border-left: 4px solid #00bcf2;
         }
         
         [data-theme="dark"] .analise-item {
             background: var(--surface) !important;
             border-color: var(--border) !important;
         }
        
        .analise-item-title {
            font-size: 12px;
            color: #6c757d;
            text-transform: uppercase;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .analise-item-value {
            font-size: 24px;
            font-weight: 700;
            color: #00bcf2;
        }
        
        .analise-item-desc {
            font-size: 13px;
            color: #6c757d;
            margin-top: 8px;
        }
        
        /* Responsive Styles */
        @media (max-width: 1024px) {
            .powerbi-container {
                padding: 16px 20px;
            }
            
            .toolbar {
                flex-direction: column;
                align-items: stretch;
                gap: 12px;
            }
            
            .toolbar > div {
                width: 100%;
            }
            
            .search-box {
                width: 100%;
            }
            
            .stats {
                flex-direction: column;
                gap: 12px;
            }
            
            .tendencia-charts {
                grid-template-columns: 1fr;
            }
            
            .periodo-selectors {
                flex-direction: column;
                align-items: stretch;
            }
            
            .periodo-selector {
                width: 100%;
            }
            
            .periodo-selector select {
                width: 100%;
            }
        }
        
        @media (max-width: 768px) {
            .powerbi-container {
                padding: 12px 16px;
            }
            
            .toolbar {
                padding: 12px;
                gap: 8px;
            }
            
            .btn {
                padding: 8px 12px;
                font-size: 13px;
                width: 100%;
                margin-left: 0;
                margin-top: 4px;
            }
            
            .table-container {
                max-height: 60vh;
            }
            
            th, td {
                padding: 8px 6px;
                font-size: 12px;
            }
            
            .stat-number {
                font-size: 20px;
            }
            
            .stat-label {
                font-size: 12px;
            }
        }
        
        @media (max-width: 480px) {
            .powerbi-container {
                padding: 8px 12px;
            }
            
            th, td {
                padding: 6px 4px;
                font-size: 11px;
                min-width: 80px;
            }
            
            .btn {
                padding: 10px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="powerbi-container">
        <div class="dados-content">
            <!-- Seletores de Per√≠odo -->
            <div class="periodo-selectors">
                <div class="periodo-selector">
                    <label for="anoSelect">Ano</label>
                    <select id="anoSelect" onchange="atualizarPeriodo()">
                        <option value="">Todos os anos</option>
                    </select>
                </div>
                <div class="periodo-selector">
                    <label for="mesSelect">M√™s</label>
                    <select id="mesSelect" onchange="atualizarPeriodo()">
                        <option value="">Todos os meses</option>
                        <option value="01">Janeiro</option>
                        <option value="02">Fevereiro</option>
                        <option value="03">Mar√ßo</option>
                        <option value="04">Abril</option>
                        <option value="05">Maio</option>
                        <option value="06">Junho</option>
                        <option value="07">Julho</option>
                        <option value="08">Agosto</option>
                        <option value="09">Setembro</option>
                        <option value="10">Outubro</option>
                        <option value="11">Novembro</option>
                        <option value="12">Dezembro</option>
                    </select>
                </div>
            </div>
            
            <!-- Abas de Meses -->
            <div class="meses-tabs">
                <div class="meses-tabs-header">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Navega√ß√£o R√°pida:</span>
                </div>
                <div class="mes-tab" data-mes="01" onclick="selecionarMes('01')">Jan</div>
                <div class="mes-tab" data-mes="02" onclick="selecionarMes('02')">Fev</div>
                <div class="mes-tab" data-mes="03" onclick="selecionarMes('03')">Mar</div>
                <div class="mes-tab" data-mes="04" onclick="selecionarMes('04')">Abr</div>
                <div class="mes-tab" data-mes="05" onclick="selecionarMes('05')">Mai</div>
                <div class="mes-tab" data-mes="06" onclick="selecionarMes('06')">Jun</div>
                <div class="mes-tab" data-mes="07" onclick="selecionarMes('07')">Jul</div>
                <div class="mes-tab" data-mes="08" onclick="selecionarMes('08')">Ago</div>
                <div class="mes-tab" data-mes="09" onclick="selecionarMes('09')">Set</div>
                <div class="mes-tab" data-mes="10" onclick="selecionarMes('10')">Out</div>
                <div class="mes-tab" data-mes="11" onclick="selecionarMes('11')">Nov</div>
                <div class="mes-tab" data-mes="12" onclick="selecionarMes('12')">Dez</div>
            </div>
            
            <!-- Visualiza√ß√£o de Tend√™ncia Anual -->
            <div id="tendenciaAnual" class="tendencia-anual">
                <div class="tendencia-header">
                    <h3><i class="fas fa-chart-line"></i> An√°lise de Tend√™ncia Anual</h3>
                    <button class="btn btn-secondary" onclick="fecharTendencia()">
                        <i class="fas fa-times"></i> Fechar
                    </button>
                </div>
                <div class="tendencia-charts">
                    <div class="tendencia-chart">
                        <canvas id="chartTendenciaMensal"></canvas>
                    </div>
                    <div class="tendencia-chart">
                        <canvas id="chartTendenciaAcumulado"></canvas>
                    </div>
                </div>
                <div class="analise-macro">
                    <h4><i class="fas fa-brain"></i> An√°lise Macro</h4>
                    <div class="analise-macro-content" id="analiseMacroContent">
                        <!-- Conte√∫do ser√° preenchido dinamicamente -->
                    </div>
                </div>
            </div>
            
            <!-- Toolbar -->
            <div class="toolbar">
                <div>
                    <input type="text" id="searchBox" class="search-box" placeholder="üîç Buscar dados...">
                    <select id="ordenacaoCampo" class="search-box" style="width: 180px; margin-left: 8px;" onchange="aplicarOrdenacao()">
                        <option value="">Ordenar por...</option>
                    </select>
                    <select id="ordenacaoDirecao" class="search-box" style="width: 150px; margin-left: 8px;" onchange="aplicarOrdenacao()">
                        <option value="asc">Crescente ‚Üë</option>
                        <option value="desc">Decrescente ‚Üì</option>
                    </select>
                    <button class="btn btn-secondary" onclick="clearFilters()">
                        <i class="fas fa-times"></i> Limpar Filtros
                    </button>
                </div>
                <div>
                    <button class="btn btn-primary" onclick="exportData()">
                        <i class="fas fa-download"></i> Exportar Excel
                    </button>
                    <button class="btn btn-secondary" onclick="detectarGeneros()" style="margin-left: 8px;">
                        <i class="fas fa-robot"></i> Detectar G√™neros
                    </button>
                </div>
            </div>
            
            <!-- Stats -->
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="totalRecords">0</div>
                    <div class="stat-label">Total de Registros</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="filteredRecords">0</div>
                    <div class="stat-label">Registros Filtrados</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="activeFilters">0</div>
                    <div class="stat-label">Filtros Ativos</div>
                </div>
            </div>
            
            <!-- Data Table -->
            <div class="data-table">
                <div class="table-header">
                    <i class="fas fa-table"></i> Dados dos Atestados
                    <div style="float: right; font-size: 12px; color: #6c757d; margin-top: 4px;">
                        <i class="fas fa-keyboard"></i> Use as setas para navegar, Enter para editar, Home/End para in√≠cio/fim
                        <br>
                        <i class="fas fa-arrows-alt-h"></i> Use a barra de rolagem horizontal para ver todas as colunas
                    </div>
                </div>
                <div class="table-container">
                    <table id="dataTable">
                        <thead id="tableHead">
                            <tr>
                                <th>ID</th>
                                <th>Funcion√°rio</th>
                                <th>CPF</th>
                                <th>Setor</th>
                                <th>G√™nero</th>
                                <th>Data Afastamento</th>
                                <th>Data Retorno</th>
                                <th>Tipo</th>
                                <th>CID</th>
                                <th>Descri√ß√£o CID</th>
                                <th>Dias</th>
                                <th>Horas</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <tr>
                                <td colspan="12" style="text-align: center; padding: 40px;">
                                    <i class="fas fa-spinner fa-spin"></i> Carregando dados...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <script src="/static/js/auth.js"></script>
    <script src="/static/js/dados_powerbi.js">    </script>
    
    <!-- Footer -->
    <footer style="background: var(--surface); border-top: 1px solid var(--border); padding: 20px; text-align: center; color: var(--text-secondary); font-size: 13px; margin-top: 40px;">
        <p style="margin: 0;">
            &copy; 2025 GrupoBiomed - Criado por √âde Carlos Viana Machado
        </p>
    </footer>
</body>
</html>
