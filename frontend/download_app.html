<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baixar App Desktop - AbsenteismoController</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%231a237e'/><text x='50' y='70' font-size='60' text-anchor='middle' fill='white'>A</text></svg>">
    <link rel="stylesheet" href="/static/css/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .download-hero {
            background: linear-gradient(135deg, #1a237e 0%, #3949ab 100%);
            color: white;
            padding: 60px 40px;
            text-align: center;
            border-radius: 16px;
            margin-bottom: 40px;
            box-shadow: 0 8px 32px rgba(26, 35, 126, 0.3);
        }
        
        .download-hero h1 {
            font-size: 42px;
            font-weight: 700;
            margin-bottom: 16px;
            text-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        
        .download-hero p {
            font-size: 18px;
            opacity: 0.95;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .app-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin: 40px 0;
        }
        
        .feature-card {
            background: var(--surface);
            padding: 32px;
            border-radius: 12px;
            box-shadow: var(--shadow-md);
            text-align: center;
            transition: var(--transition);
            border: 2px solid transparent;
        }
        
        .feature-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-light);
        }
        
        .feature-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #1a237e, #3949ab);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 36px;
            color: white;
            box-shadow: 0 4px 16px rgba(26, 35, 126, 0.3);
        }
        
        .feature-card h3 {
            color: var(--primary);
            font-size: 20px;
            margin-bottom: 12px;
        }
        
        .feature-card p {
            color: var(--text-secondary);
            line-height: 1.6;
        }
        
        .download-section {
            background: var(--surface);
            padding: 40px;
            border-radius: 12px;
            box-shadow: var(--shadow-md);
            text-align: center;
            margin-top: 40px;
        }
        
        .download-btn {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            background: linear-gradient(135deg, #1a237e, #3949ab);
            color: white;
            padding: 18px 40px;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            text-decoration: none;
            box-shadow: 0 4px 16px rgba(26, 35, 126, 0.4);
            transition: var(--transition);
            margin: 20px 10px;
        }
        
        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 24px rgba(26, 35, 126, 0.5);
            background: linear-gradient(135deg, #3949ab, #5c6bc0);
        }
        
        .download-btn i {
            font-size: 24px;
        }
        
        .app-preview {
            background: var(--surface);
            padding: 40px;
            border-radius: 12px;
            box-shadow: var(--shadow-md);
            margin-top: 40px;
        }
        
        .app-preview h2 {
            color: var(--primary);
            margin-bottom: 24px;
            text-align: center;
        }
        
        .preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .preview-item {
            text-align: center;
            padding: 20px;
            background: var(--background);
            border-radius: 8px;
        }
        
        .preview-item i {
            font-size: 48px;
            color: var(--primary);
            margin-bottom: 12px;
        }
        
        .preview-item h4 {
            color: var(--text-primary);
            margin-bottom: 8px;
        }
        
        .preview-item p {
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        .system-requirements {
            background: var(--background);
            padding: 32px;
            border-radius: 12px;
            margin-top: 40px;
        }
        
        .system-requirements h3 {
            color: var(--primary);
            margin-bottom: 20px;
        }
        
        .requirements-list {
            list-style: none;
            padding: 0;
        }
        
        .requirements-list li {
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .requirements-list li:last-child {
            border-bottom: none;
        }
        
        .requirements-list i {
            color: var(--success);
            font-size: 20px;
        }
        
        .version-info {
            background: var(--background);
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            text-align: center;
            color: var(--text-secondary);
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <i class="fas fa-chart-line"></i> AbsenteismoController
                </div>
                <div class="sidebar-subtitle">GrupoBiomed</div>
            </div>
            
            <nav class="sidebar-nav">
                <a href="/dashboard" class="nav-item">
                    <i class="fas fa-chart-line"></i>
                    <span>Dashboard</span>
                </a>
                <a href="/clientes" class="nav-item">
                    <i class="fas fa-building"></i>
                    <span>üè¢ Clientes</span>
                </a>
                <a href="/apresentacao" class="nav-item">
                    <i class="fas fa-tv"></i>
                    <span>üìä Apresenta√ß√£o</span>
                </a>
                <a href="/upload" class="nav-item">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <span>üì§ Upload Planilha</span>
                </a>
                <a href="/dados_powerbi" class="nav-item">
                    <i class="fas fa-table"></i>
                    <span>üìã Meus Dados</span>
                </a>
                <a href="/funcionarios" class="nav-item">
                    <i class="fas fa-users"></i>
                    <span>üë• Funcion√°rios</span>
                </a>
                <a href="/comparativos" class="nav-item">
                    <i class="fas fa-balance-scale"></i>
                    <span>‚öñÔ∏è Comparativos</span>
                </a>
                <a href="/configuracoes" class="nav-item">
                    <i class="fas fa-cog"></i>
                    <span>‚öôÔ∏è Configura√ß√µes</span>
                </a>
                <a href="/download_app" class="nav-item" id="navDownloadApp">
                    <i class="fas fa-download"></i>
                    <span>üì± Baixar App</span>
                </a>
            </nav>
            
            <div style="padding: 20px; margin-top: auto; border-top: 1px solid #e0e0e0;">
                <div id="userInfo" style="background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 12px; color: #666; margin-bottom: 10px;">
                        <i class="fas fa-user"></i> <span id="userName">Usu√°rio</span>
                    </div>
                    <button onclick="logout()" class="btn btn-secondary" style="width: 100%; padding: 8px; font-size: 12px;">
                        <i class="fas fa-sign-out-alt"></i> Sair
                    </button>
                </div>
            </div>
        </aside>
        
        <!-- Main Content -->
        <main class="main-content">
            <header class="header">
                <h1 class="header-title">Baixar App Desktop</h1>
            </header>
            
            <div class="content">
                <!-- Hero Section -->
                <div class="download-hero">
                    <h1><i class="fas fa-desktop"></i> App Desktop</h1>
                    <p>Acesse o AbsenteismoController diretamente do seu computador com um aplicativo nativo, r√°pido e bonito.</p>
                </div>
                
                <!-- Features -->
                <div class="app-features">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-bolt"></i>
                        </div>
                        <h3>Acesso R√°pido</h3>
                        <p>Acesse o sistema com um clique, sem precisar abrir o navegador.</p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-paint-brush"></i>
                        </div>
                        <h3>Interface Bonita</h3>
                        <p>Design moderno e azul, seguindo a identidade visual do sistema.</p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <h3>Seguro</h3>
                        <p>Conecta-se diretamente ao servidor seguro com HTTPS.</p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-mobile-alt"></i>
                        </div>
                        <h3>Nativo</h3>
                        <p>App nativo do Windows, integrado ao sistema operacional.</p>
                    </div>
                </div>
                
                <!-- Download Section -->
                <div class="download-section">
                    <h2 style="color: var(--primary); margin-bottom: 20px;">Baixar Agora</h2>
                    <p style="color: var(--text-secondary); margin-bottom: 30px; font-size: 16px;">
                        Clique no bot√£o abaixo para baixar e instalar o aplicativo no seu computador.
                    </p>
                    
                    <button onclick="downloadApp()" class="download-btn" id="downloadBtn" style="border: none; cursor: pointer;">
                        <i class="fas fa-download"></i>
                        <span>Baixar App Desktop</span>
                    </button>
                    
                    <div style="margin-top: 30px; padding-top: 30px; border-top: 1px solid var(--border);">
                        <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 15px;">
                            <i class="fas fa-info-circle"></i> <strong>Instru√ß√µes:</strong>
                        </p>
                        <ol style="text-align: left; max-width: 600px; margin: 0 auto; color: var(--text-secondary); line-height: 2;">
                            <li>Clique no bot√£o acima para baixar o instalador</li>
                            <li>Execute o arquivo baixado (.exe)</li>
                            <li>Siga o assistente de instala√ß√£o</li>
                            <li>O app aparecer√° no menu Iniciar</li>
                            <li>Pronto! Use o app sempre que precisar</li>
                        </ol>
                    </div>
                </div>
                
                <!-- App Preview -->
                <div class="app-preview">
                    <h2>O que voc√™ vai ter</h2>
                    <div class="preview-grid">
                        <div class="preview-item">
                            <i class="fas fa-rocket"></i>
                            <h4>Acesso Instant√¢neo</h4>
                            <p>Abra o sistema com um clique</p>
                        </div>
                        <div class="preview-item">
                            <i class="fas fa-palette"></i>
                            <h4>Design Azul</h4>
                            <p>Interface bonita e moderna</p>
                        </div>
                        <div class="preview-item">
                            <i class="fas fa-keyboard"></i>
                            <h4>Atalhos</h4>
                            <p>F5 para recarregar, F11 para tela cheia</p>
                        </div>
                        <div class="preview-item">
                            <i class="fas fa-sync"></i>
                            <h4>Sempre Atualizado</h4>
                            <p>Conecta-se ao servidor em tempo real</p>
                        </div>
                    </div>
                </div>
                
                <!-- System Requirements -->
                <div class="system-requirements">
                    <h3><i class="fas fa-check-circle"></i> Requisitos do Sistema</h3>
                    <ul class="requirements-list">
                        <li>
                            <i class="fas fa-check"></i>
                            <span><strong>Windows:</strong> Windows 10 ou superior</span>
                        </li>
                        <li>
                            <i class="fas fa-check"></i>
                            <span><strong>Espa√ßo em disco:</strong> 100 MB livres</span>
                        </li>
                        <li>
                            <i class="fas fa-check"></i>
                            <span><strong>Internet:</strong> Conex√£o est√°vel para acessar o sistema</span>
                        </li>
                        <li>
                            <i class="fas fa-check"></i>
                            <span><strong>Navegador:</strong> N√£o √© necess√°rio (app nativo)</span>
                        </li>
                    </ul>
                </div>
                
                <div class="version-info">
                    <i class="fas fa-info-circle"></i> Vers√£o 2.0.0 | Desenvolvido por GrupoBiomed
                </div>
            </div>
        </main>
    </div>
    
    <script src="/static/js/auth.js"></script>
    <script>
        // Carregar nome do usu√°rio
        document.addEventListener('DOMContentLoaded', () => {
            // Verificar autentica√ß√£o
            const token = localStorage.getItem('access_token');
            if (!token) {
                window.location.href = '/landing';
                return;
            }
            
            try {
                const payload = JSON.parse(atob(token.split('.')[1]));
                const userNameEl = document.getElementById('userName');
                if (userNameEl && payload.sub) {
                    userNameEl.textContent = payload.sub;
                }
            } catch (e) {
                console.error('Erro ao decodificar token:', e);
                window.location.href = '/landing';
            }
        });
        
        // Fun√ß√£o de logout
        function logout() {
            localStorage.removeItem('access_token');
            window.location.href = '/landing';
        }
        
        // Adicionar classe active ao menu item
        document.addEventListener('DOMContentLoaded', () => {
            const downloadNavItem = document.getElementById('navDownloadApp');
            if (downloadNavItem) {
                downloadNavItem.classList.add('active');
            }
        });
        
        // Fun√ß√£o para baixar o app
        async function downloadApp() {
            const btn = document.getElementById('downloadBtn');
            const originalText = btn.innerHTML;
            
            try {
                // Mostrar loading
                btn.disabled = true;
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> <span>Preparando download...</span>';
                
                // Obter token
                const token = localStorage.getItem('access_token');
                if (!token) {
                    alert('Voc√™ precisa estar logado para baixar o app. Redirecionando...');
                    window.location.href = '/landing';
                    return;
                }
                
                // Fazer requisi√ß√£o com token
                const response = await fetch('/api/download/app', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (!response.ok) {
                    if (response.status === 403) {
                        throw new Error('Acesso negado. Verifique se voc√™ est√° logado.');
                    } else if (response.status === 404) {
                        throw new Error('App n√£o encontrado. Entre em contato com o administrador.');
                    } else {
                        throw new Error(`Erro ${response.status}: ${response.statusText}`);
                    }
                }
                
                // Obter blob do arquivo
                const blob = await response.blob();
                
                // Criar link de download
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'AbsenteismoController-App-Desktop.zip';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
                
                // Sucesso
                btn.innerHTML = '<i class="fas fa-check"></i> <span>Download conclu√≠do!</span>';
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }, 2000);
                
            } catch (error) {
                console.error('Erro ao baixar app:', error);
                alert('Erro ao baixar o app: ' + error.message);
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>

